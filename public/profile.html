<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login</title>
</head>
<body>
  <h2>Profile</h2>

  <main></main>
  <script>
    window.addEventListener('load', async () => {
      const token = sessionStorage.getItem('token')
      const main = document.querySelector('main')

      if(!token){
        main.innerText = 'Invalid token, redirection to /login.html in 3 seconds...'
        setTimeout(()=>{
          document.location.href = 'login.html'
        }, 3000)
        return
      }

      const nameEl = document.createElement('p')
      const user = await fetch('profile', {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })
        .then((response)=>response.json())
        .then((data)=>data)
        .catch(e=>{
          console.error(e)
          main.innerText = `Error: ${e}`
        })

      if(user){
        nameEl.innerText = JSON.stringify(user)

        main.appendChild(nameEl)
      }
    })
  </script>
</body>
</html>
